services:
  grafana:
    container_name: 'clevercloud-warp10-datasource'
    build:
      context: ../../.config
      args:
        grafana_version: ${GRAFANA_VERSION:-11.4.4}
    ports:
      - 3000:3000
    volumes:
      - ../../dist:/var/lib/grafana/plugins/clevercloud-warp10-datasource
      - ../../provisioning:/etc/grafana/provisioning
    depends_on:
      - warp10
    networks:
      - warp10-net
    environment:
      - GF_PLUGINS_ALLOW_LOADING_UNSIGNED_PLUGINS=clevercloud-warp10-datasource
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/login"]
      interval: 10s
      timeout: 5s
      retries: 6

  warp10:
    image: warp10io/warp10:3.4.1-alpine
    container_name: warp10
    ports:
      - 8080:8080
      - 8081:8081
    networks:
      - warp10-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 10s
      timeout: 5s
      retries: 6

networks:
  warp10-net:
    driver: bridge
